name: releasePackage

description: Add the GitHub Packages nuget source and publish the package 

inputs:
  username:
    description: 'The username to be used to connect to GitHub Packages nuget source'
    required: true
  password:
    description: 'The api key to be used to connect to GitHub Packages nuget source'
    required: true
  artifactName:
    description: 'The build artifact name'
    required: true
  commitsSinceVersionSource: 
    description: 'The number of commits since version source'
    required: true
  buildPackageVersion:
    description: 'The build package version'
    required: true

runs:
  using: "composite"
  # Defining the action steps
  steps:
    - name: Download nuget package artifact
      uses: actions/download-artifact@v1.0.0
      with:
        name: ${{ inputs.artifactName }}
        
    - name: Prep package
      run: dotnet nuget add source --username ${{ inputs.username }} --password ${{ inputs.password }} --store-password-in-clear-text --name github "https://nuget.pkg.github.com/codecreate-sa/index.json"
      shell: bash

    - name: Push package to GitHub packages
      if: ${{ inputs.commitsSinceVersionSource }} > 0 # Only release if there has been a commit/version change  
      run: dotnet nuget push ${{ inputs.artifactName }}/*.nupkg --api-key ${{ inputs.password }} --source "github"
      shell: bash

    - name: Create Release
      if: ${{ inputs.commitsSinceVersionSource }} > 0 # Only release if there has been a commit/version change  
      uses: ncipollo/release-action@v1
      with:
        tag: ${{ inputs.buildPackageVersion }}
        name: Release ${{ inputs.buildPackageVersion }}
        artifacts: "${{ inputs.artifactName }}/*"
        token: ${{ inputs.password }}